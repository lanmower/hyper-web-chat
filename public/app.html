<app>
    <div class="fixed w-full bg-green-400 h-16 pt-2 text-white flex justify-between shadow-md" style="top:0px; overscroll-behavior: none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 h-8 my-1 text-green-100 ml-2">
        <path class="text-green-100 fill-current" fill-rule="evenodd" d="M12 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"></path>
        </svg>
        <div class="my-3 text-green-100 font-bold text-lg tracking-wide">{state?.channels[state.channelId]?.name}</div>
      </div>

    <messages channelId={state.channelId} messages={state.messages} emit={emit}></messages>
    <!--channellist channels={state.channels} emit={emit} parentUpdate={update}></channellist>
    <userlist name={state.name} emit={emit}></userlist>
    <terminal hash={state.channelId}></terminal>
    <roleList roles={state.roles} emit={emit} parentUpdate={update}></roleList-->
    <script>
        export default {
            state:{
                messages: {
                    
                },
                channels: {

                },
                roles: {
                    "everyone":[]
                },
                permissions: {

                }
            },
            actions:window.actions,
            emit(action, input='') {
                const self = this;
                const socket = window.socket;
                return new Promise((res)=>{
                    if(socket && socket.readyState === WebSocket.CONNECTING) {
                        console.log('not connected, waiting');
                        socket.addEventListener('open', (event) => {
                            console.log('socket open');
                            res(socket.send(sign({ action, input, keyPair })));
                        });
                    } else if(socket && socket.readyState === WebSocket.OPEN) {
                        res(socket.send(sign({ action, input, keyPair })))
                    };
                })
            },
            onMounted() {
                const self = window.app = this;
                this.emit('getChannels')
                this.emit('getProfile')
                //this.emit('getUsers')
                this.emit('getRoles')
            }
        };
    </script>
</app>